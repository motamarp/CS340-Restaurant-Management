<!DOCTYPE html>
<html>
<head>
  <title>Customers</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Customer List</h1>
  <a href="index.html">Back to Home</a>

  <!-- INSERT FORM -->
  <form id="addCustomerForm">
    <h2>Add Customer</h2>
    <label>Name: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <label>Phone: <input type="text" name="phone"></label>
    <button type="submit">Add Customer</button>
  </form>

  <table>
  <thead>
    <tr>
      <th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Join Date</th><th>Actions</th>
    </tr>
  </thead>
  <tbody id="customerTableBody">
    <!-- Data will be inserted here by JavaScript -->
  </tbody>
</table>

  <script>
  // Function to load customers from Supabase
  async function loadCustomers() {
    const tbody = document.getElementById('customerTableBody');
    tbody.innerHTML = '<tr><td colspan="6">Loading customers...</td></tr>';
    
    try {
      const { data: customers, error } = await supabase
        .from('Customers')
        .select('*')
        .order('customerID', { ascending: true });
      
      if (error) throw error;
      
      if (customers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No customers found</td></tr>';
        return;
      }
      
      tbody.innerHTML = customers.map(customer => `
        <tr>
          <td>${customer.customerID}</td>
          <td>${customer.name}</td>
          <td>${customer.email}</td>
          <td>${customer.phone || 'N/A'}</td>
          <td>${new Date(customer.joinDate).toLocaleDateString()}</td>
          <td><button onclick="deleteCustomer(${customer.customerID})">Delete</button></td>
        </tr>
      `).join('');
    } catch (error) {
      tbody.innerHTML = `<tr><td colspan="6" style="color:red">Error loading customers: ${error.message}</td></tr>`;
      console.error('Error loading customers:', error);
    }
  }

  // Function to delete a customer
  async function deleteCustomer(id) {
    if (!confirm('Are you sure you want to delete this customer?')) return;
    
    try {
      const { error } = await supabase
        .from('Customers')
        .delete()
        .eq('customerID', id);
      
      if (error) throw error;
      
      alert('Customer deleted successfully');
      loadCustomers(); // Refresh the list
    } catch (error) {
      alert(`Error deleting customer: ${error.message}`);
      console.error('Delete error:', error);
    }
  }

  // Function to add a new customer
  async function addCustomer(customerData) {
    try {
      const { error } = await supabase
        .from('Customers')
        .insert([{
          ...customerData,
          joinDate: new Date().toISOString()
        }]);
      
      if (error) throw error;
      
      alert('Customer added successfully');
      loadCustomers(); // Refresh the list
    } catch (error) {
      alert(`Error adding customer: ${error.message}`);
      console.error('Add error:', error);
    }
  }

  // Form submission handler
  document.getElementById('addCustomerForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const customerData = {
      name: formData.get('name'),
      email: formData.get('email'),
      phone: formData.get('phone')
    };
    addCustomer(customerData);
    event.target.reset();
  });

  // Load customers when page loads
  document.addEventListener('DOMContentLoaded', loadCustomers);
</script>
</body>
</html>
